webpackJsonp([11],{Qu1U:function(e,t){},yKup:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("02xr"),n=a("uxtY"),r=a("/IwO"),o=new r.AMapManager,s={name:"locusMap",data:function(){return{wrapperHeight:650,fullscreenLoading:!1,queryForm:{startTime:"",endTime:"",plateNum:"",routeName:"",terminal:"",starttag:"0",locusId:0},routeList:[],vehicles:[],zoom:12,center:[112.998758,28.182349],amapManager:o,events:{init:this.initPathSimplifierIns},map:{},pathSimplifierIns:{},pathNavigator:{},pathData:[{name:"轨迹0",path:[]}],startMark:{},endMark:{},vehicleMark:{},showVehicleMarker:[],gpsData:[],runingPoint:{reportTime:"",speed:""},vehicleInfoWindow:null,timeOut:{},locusPointIndex:0}},created:function(){this._getRouteMsg()},mounted:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.wrapperHeight=e-62},methods:{_getRouteMsg:function(){var e=this;Object(i.p)().then(function(t){t.code==n.b&&(e.routeList=t.result,e.queryForm.routeName=e.routeList[0],e._getGpsVehicles())})},_getGpsVehicles:function(){var e=this,t={routeName:this.queryForm.routeName,starttag:this.queryForm.starttag};Object(i.q)(t).then(function(t){t.code==n.b&&(e.vehicles=t.result)})},routeChange:function(){this._getGpsVehicles()},starttagChange:function(){this._getGpsVehicles()},initPathSimplifierIns:function(e){this.map=e;var t=this;AMapUI.loadUI(["misc/PathSimplifier"],function(a){t.createPathSimplifier(a,e)}),AMapUI.loadUI(["overlay/SimpleMarker"],function(a){t.startMark=new a({iconLabel:"始",iconStyle:"red",map:e}),t.endMark=new a({iconLabel:"终",iconStyle:"blue",map:e})})},createPathNavigator:function(){this.pathNavigator=this.pathSimplifierIns.createPathNavigator(0,{loop:!1,speed:120}),console.log(this.pathNavigator),this.pathNavigator.on("move",function(e){console.log(e.target.cursor.idx)})},createVehiclePointContent:function(){var e=document.createElement("div");e.style.width="24px",e.style.height="24px",e.style.borderRadius="12px",e.style.backgroundColor="#67c23a",e.style.borderColor="#67c23a",e.style.border="1px solid #67c23a";var t=document.createElement("em");return t.style.color="#FFF",t.innerHTML="car",e.appendChild(t),e},createVehicleInfoWindow:function(e){var t=document.createElement("div"),a=document.createElement("strong");a.innerHTML="时间:",t.appendChild(a);var i=document.createElement("span"),n=e.createTime.split(" ");i.innerHTML=n[1],t.appendChild(i);var r=document.createElement("div"),o=document.createElement("strong");o.innerHTML="车速:",r.appendChild(o);var s=document.createElement("span");s.innerHTML=Math.floor(100*parseFloat(e.speed))/100+"km/h",r.appendChild(s);var l=document.createElement("div");return l.style.width="120px",l.appendChild(t),l.appendChild(r),l},createPathSimplifier:function(e,t){this.pathSimplifierIns=new e({zIndex:100,map:t,getPath:function(e,t){return e.path},getHoverTitle:function(e,t,a){return a>=0?e.name+"，点:"+a+"/"+e.path.length:e.name+"，GPS点数量"+e.path.length},renderOptions:{pathLineStyle:{strokeStyle:"#409EFF",lineWidth:6,dirArrowStyle:!0}}})},setData:function(){this.pathSimplifierIns.setData(this.pathData),this.pathSimplifierIns.render()},moveVehicle:function(e){var t=this;e>=this.gpsData.length?clearTimeout(this.timeOut):(this.vehicleMark.setPosition(this.gpsData[e].lngLat),this.vehicleInfoWindow.setContent(this.createVehicleInfoWindow(this.gpsData[e])),this.vehicleInfoWindow.open(this.map,this.gpsData[e].lngLat),this.timeOut=setTimeout(function(){t.locusPointIndex=e+1,t.moveVehicle(t.locusPointIndex)},500))},destoryData:function(){clearTimeout(this.timeOut),null!=this.vehicleInfoWindow&&(this.vehicleInfoWindow.close(),this.map.remove(this.vehicleInfoWindow)),this.map.remove(this.vehicleMark),this.gpsData=null},query:function(){var e=this;this.fullscreenLoading=!0,this.destoryData(),Object(i.o)(this.queryForm).then(function(t){if(e.fullscreenLoading=!1,t.code==n.b)if(t.code==n.b){if(0==t.result.length)return void e.$message.error("该时间段内车辆无轨迹数据");e.pathData[0].path=[],t.result.forEach(function(t){var a=[t.longitude,t.latitude];t.lngLat=a,e.pathData[0].path.push(a)}),e.gpsData=t.result,e.setData(),e.startMark.setPosition(e.pathData[0].path[0]),e.endMark.setPosition(e.pathData[0].path[t.result.length-1]),e.locusPointIndex=0,e.vehicleMark=new AMap.Marker({offset:new AMap.Pixel(-12,-12),map:e.map,content:e.createVehiclePointContent(),zIndex:1002}),e.vehicleInfoWindow=new AMap.InfoWindow}else e.$message.error(t.define);else e.$message.error(t.define)})},start:function(){this.moveVehicle(this.locusPointIndex)},reset:function(){clearTimeout(this.timeOut),this.locusPointIndex=0},pause:function(){clearTimeout(this.timeOut)},saveSupplement:function(){var e=this;this.fullscreenLoading=!0,saveMeta(this.queryForm).then(function(t){e.fullscreenLoading=!1,t.code==n.b?(e.queryForm.startDate="",e.queryForm.endDate="",e.$message.success("保存成功")):e.$message.error(t.define)})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap-map"},[a("div",{staticClass:"amap-page-container"},[a("el-amap",{staticClass:"amap-demo",style:{height:e.wrapperHeight+"px"},attrs:{vid:"amapDemo",center:e.center,"map-manager":e.amapManager,zoom:e.zoom,events:e.events}})],1),e._v(" "),a("div",{staticClass:"running-info-panel"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.start}},[e._v("开始")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.pause}},[e._v("暂停")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.reset}},[e._v("重置")])],1),e._v(" "),a("div",{staticClass:"query-form-panel"},[a("el-collapse",[a("el-collapse-item",{attrs:{title:"查询面版"}},[a("el-form",{ref:"form",staticClass:"query-form-box",attrs:{model:e.queryForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"线路"}},[a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{size:"medium",placeholder:"请选择线路"},on:{change:e.routeChange},model:{value:e.queryForm.routeName,callback:function(t){e.$set(e.queryForm,"routeName",t)},expression:"queryForm.routeName"}},e._l(e.routeList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"方向"}},[a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{size:"medium",placeholder:"请选择线路"},on:{change:e.starttagChange},model:{value:e.queryForm.starttag,callback:function(t){e.$set(e.queryForm,"starttag",t)},expression:"queryForm.starttag"}},[a("el-option",{attrs:{label:"上行",value:"0"}}),e._v(" "),a("el-option",{attrs:{label:"下行",value:"1"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"车牌号"}},[a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{size:"medium",placeholder:"请选择线路"},model:{value:e.queryForm.locusId,callback:function(t){e.$set(e.queryForm,"locusId",t)},expression:"queryForm.locusId"}},e._l(e.vehicles,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary",size:"small"},on:{click:e.query}},[e._v("查询轨迹")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var c=a("VU/8")(s,l,!1,function(e){a("Qu1U")},"data-v-5341f340",null);t.default=c.exports}});
//# sourceMappingURL=11.ecb331376204992d90bd.js.map