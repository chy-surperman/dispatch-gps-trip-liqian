webpackJsonp([13],{J1wO:function(e,t){},rspu:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Dd8w"),n=a.n(i),r=a("02xr"),o=a("uxtY"),s=a("/IwO"),l=new s.AMapManager,c={name:"locusMap",data:function(){return{wrapperHeight:650,fullscreenLoading:!1,queryForm:{startTime:"",vehicleId:"",endTime:"",plateNum:"",routeName:"",terminal:"",starttag:""},routeList:[],vehicles:[],zoom:12,center:[112.998758,28.182349],amapManager:l,events:{init:this.initPathSimplifierIns},map:{},pathSimplifierIns:{},pathNavigator:{},pathData:[{name:"轨迹0",path:[]}],startMark:{},endMark:{},vehicleMark:{},showVehicleMarker:[],gpsData:[],runingPoint:{reportTime:"",speed:""},vehicleInfoWindow:null,timeOut:{},locusPointIndex:0}},created:function(){this._getRouteMsg()},mounted:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.wrapperHeight=e-62},methods:{_getRouteMsg:function(){var e=this;Object(r.r)().then(function(t){t.code==o.b&&(e.routeList=t.result,e.queryForm.routeName=e.routeList[0],e._getGpsVehicles())})},_getGpsVehicles:function(){var e=this,t=n()({},this.queryForm);Object(r.n)(t).then(function(t){t.code==o.b&&(e.vehicles=t.result,e.queryForm.plateNum=e.vehicles[0].plateNum)})},routeChange:function(){this._getGpsVehicles()},timeChange:function(){this._getGpsVehicles()},initPathSimplifierIns:function(e){this.map=e;var t=this;AMapUI.loadUI(["misc/PathSimplifier"],function(a){t.createPathSimplifier(a,e)}),AMapUI.loadUI(["overlay/SimpleMarker"],function(a){t.startMark=new a({iconLabel:"始",iconStyle:"red",map:e}),t.endMark=new a({iconLabel:"终",iconStyle:"blue",map:e})})},createPathNavigator:function(){this.pathNavigator=this.pathSimplifierIns.createPathNavigator(0,{loop:!1,speed:120}),console.log(this.pathNavigator),this.pathNavigator.on("move",function(e){console.log(e.target.cursor.idx)})},createVehiclePointContent:function(){var e=document.createElement("div");e.style.width="24px",e.style.height="24px",e.style.borderRadius="12px",e.style.backgroundColor="#67c23a",e.style.borderColor="#67c23a",e.style.border="1px solid #67c23a";var t=document.createElement("em");return t.style.color="#FFF",t.innerHTML="car",e.appendChild(t),e},createVehicleInfoWindow:function(e){var t=document.createElement("div"),a=document.createElement("strong");a.innerHTML="时间:",t.appendChild(a);var i=document.createElement("span"),n=e.reportTime.split(" ");i.innerHTML=n[1],t.appendChild(i);var r=document.createElement("div"),o=document.createElement("strong");o.innerHTML="车速:",r.appendChild(o);var s=document.createElement("span");s.innerHTML=Math.floor(100*parseFloat(e.speed))/100+"km/h",r.appendChild(s);var l=document.createElement("div");return l.style.width="120px",l.appendChild(t),l.appendChild(r),l},createPathSimplifier:function(e,t){this.pathSimplifierIns=new e({zIndex:100,map:t,getPath:function(e,t){return e.path},getHoverTitle:function(e,t,a){return a>=0?e.name+"，点:"+a+"/"+e.path.length:e.name+"，GPS点数量"+e.path.length},renderOptions:{pathLineStyle:{strokeStyle:"#409EFF",lineWidth:6,dirArrowStyle:!0}}})},setData:function(){this.pathSimplifierIns.setData(this.pathData),this.pathSimplifierIns.render()},moveVehicle:function(e){var t=this;e>=this.gpsData.length?clearTimeout(this.timeOut):(this.vehicleMark.setPosition(this.gpsData[e].lngLat),this.vehicleInfoWindow.setContent(this.createVehicleInfoWindow(this.gpsData[e])),this.vehicleInfoWindow.open(this.map,this.gpsData[e].lngLat),this.timeOut=setTimeout(function(){t.locusPointIndex=e+1,t.moveVehicle(t.locusPointIndex)},500))},destoryData:function(){clearTimeout(this.timeOut),null!=this.vehicleInfoWindow&&(this.vehicleInfoWindow.close(),this.map.remove(this.vehicleInfoWindow)),this.map.remove(this.vehicleMark),this.gpsData=null},query:function(){var e=this;this.fullscreenLoading=!0,this.destoryData(),Object(r.m)(this.queryForm).then(function(t){if(e.fullscreenLoading=!1,t.code==o.b)if(t.code==o.b){if(0==t.result.length)return void e.$message.error("该时间段内车辆无轨迹数据");e.pathData[0].path=[],t.result.forEach(function(t){var a=[t.longitude,t.latitude];t.lngLat=a,t.reportTime||(t.reportTime=t.time),e.pathData[0].path.push(a)}),e.gpsData=t.result,e.setData(),e.startMark.setPosition(e.pathData[0].path[0]),e.endMark.setPosition(e.pathData[0].path[t.result.length-1]),e.locusPointIndex=0,e.vehicleMark=new AMap.Marker({offset:new AMap.Pixel(-12,-12),map:e.map,content:e.createVehiclePointContent(),zIndex:1002}),e.vehicleInfoWindow=new AMap.InfoWindow}else e.$message.error(t.define);else e.$message.error(t.define)}).catch(function(){e.fullscreenLoading=!1,e.$message.error("错误")})},start:function(){this.moveVehicle(this.locusPointIndex)},reset:function(){clearTimeout(this.timeOut),this.locusPointIndex=0},pause:function(){clearTimeout(this.timeOut)},saveSupplement:function(){var e=this;this.fullscreenLoading=!0,Object(r.z)(this.queryForm).then(function(t){e.fullscreenLoading=!1,t.code==o.b?(e.queryForm.startDate="",e.queryForm.endDate="",e.$message.success("保存成功")):e.$message.error(t.define)})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wrap-map"},[a("div",{staticClass:"amap-page-container"},[a("el-amap",{staticClass:"amap-demo",style:{height:e.wrapperHeight+"px"},attrs:{vid:"amapDemo",center:e.center,"map-manager":e.amapManager,zoom:e.zoom,events:e.events}})],1),e._v(" "),a("div",{staticClass:"running-info-panel"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.start}},[e._v("开始")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.pause}},[e._v("暂停")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.reset}},[e._v("重置")])],1),e._v(" "),a("div",{staticClass:"query-form-panel"},[a("el-collapse",[a("el-collapse-item",{attrs:{title:"查询面版"}},[a("el-form",{ref:"form",staticClass:"query-form-box",attrs:{model:e.queryForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"起始时间"}},[a("el-col",{attrs:{span:20}},[a("el-date-picker",{attrs:{type:"datetime",size:"medium",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},on:{change:e.timeChange},model:{value:e.queryForm.startTime,callback:function(t){e.$set(e.queryForm,"startTime",t)},expression:"queryForm.startTime"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-col",{attrs:{span:20}},[a("el-date-picker",{attrs:{size:"medium",type:"datetime",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},on:{change:e.timeChange},model:{value:e.queryForm.endTime,callback:function(t){e.$set(e.queryForm,"endTime",t)},expression:"queryForm.endTime"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"线路"}},[a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{filterable:"",size:"medium",placeholder:"请选择线路"},on:{change:e.routeChange},model:{value:e.queryForm.routeName,callback:function(t){e.$set(e.queryForm,"routeName",t)},expression:"queryForm.routeName"}},e._l(e.routeList,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}))],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"车牌号"}},[a("el-col",{attrs:{span:20}},[a("el-select",{attrs:{filterable:"",size:"medium",placeholder:"请选择线路"},model:{value:e.queryForm.vehicleId,callback:function(t){e.$set(e.queryForm,"vehicleId",t)},expression:"queryForm.vehicleId"}},e._l(e.vehicles,function(t){return a("el-option",{key:t.vehicleId,attrs:{label:t.selfNum,value:t.vehicleId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.selfNum))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.plateNum))])])}))],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary",size:"small"},on:{click:e.query}},[e._v("查询轨迹")])],1)],1)],1)],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(c,m,!1,function(e){a("J1wO")},"data-v-4ba5c6a5",null);t.default=u.exports}});
//# sourceMappingURL=13.560643bf75422a8cc9e3.js.map